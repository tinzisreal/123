{% extends "appbuilder/baselayout.html" %}
{% from 'superset/partials/asset_bundle.html' import css_bundle, js_bundle with context %}

{% block head_css %}
  {{ super() }}
  {{ css_bundle("theme") }}
{% endblock %}

{% block head_js %}
  {{ super() }}
  {{ js_bundle("theme") }}
{% endblock %}

{% block tail_js %}
  {{ super() }}
  {{ js_bundle("preamble") }}
  {{ js_bundle("menu") }}
  {% include "tail_js_custom_extra.html" %}

  <script nonce="{{ csp_nonce() }}">
  document.addEventListener("DOMContentLoaded", function() {
    console.log("âœ… base.html JS loaded!");

    // tÃ¬m táº¥t cáº£ link cÃ³ /logout (cÃ³ thá»ƒ kÃ¨m query)
    const logoutLinks = document.querySelectorAll("a[href^='/logout']");
    console.log("Found logout links:", logoutLinks);

    logoutLinks.forEach(logoutLink => {
      // Ä‘á»•i nhÃ£n nÃºt (náº¿u muá»‘n)
      logoutLink.textContent = "ðŸšª Logout Superset";

      // cháº·n click máº·c Ä‘á»‹nh
      logoutLink.addEventListener("click", function(e) {
        e.preventDefault();
        console.log("ðŸšª Custom Logout clicked!");

        const w = 400, h = 300;
        const left = (screen.width - w) / 2;
        const top = (screen.height - h) / 2;

        const popup = window.open(
          logoutLink.getAttribute("href") || "/logout/",
          "SupersetLogout",
          `width=${w},height=${h},top=${top},left=${left}`
        );

        if (!popup) {
          alert("âš ï¸ Popup bá»‹ cháº·n, hÃ£y báº­t popup cho site nÃ y.");
          return;
        }

        // auto Ä‘Ã³ng popup + reload láº¡i
        setTimeout(() => {
          if (!popup.closed) popup.close();
          window.location.href = "/login/";
        }, 800);
      });
    });
  });
  </script>
{% endblock %}
