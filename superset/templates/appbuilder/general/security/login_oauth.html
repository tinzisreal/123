{% extends "appbuilder/base.html" %}
{% block content %}
<div class="container" style="margin-top:100px; max-width:400px;">
  <div class="card">
    <div class="card-body">
      <h3 class="card-title">Sign In with OAuth</h3>
      <button id="kc-login-btn" class="btn btn-primary" style="width:100%; margin-top:20px;">
        SIGN IN WITH KEYCLOAK ðŸ”‘
      </button>
    </div>
  </div>
</div>
<script nonce="{{ csp_nonce() }}">
document.getElementById("kc-login-btn").onclick = function(e) {
  e.preventDefault();
  console.log("CLICKED KC BUTTON");

  const w = 600, h = 700;
  const left = (screen.width - w) / 2;
  const top = (screen.height - h) / 2;

  const popup = window.open(
    "http://localhost:8088/login/keycloak",
    "Keycloak Login",
    `width=${w},height=${h},top=${top},left=${left}`
  );

  if (!popup) {
    alert("Popup blocked! HÃ£y báº­t popup cho site nÃ y.");
    return;
  }

  // Láº¯ng nghe message tá»« popup
  window.addEventListener("message", (event) => {
    if (event.data === "kc-login-success") {
      console.log("Login success, closing popup...");
      if (!popup.closed) popup.close();
      window.location.reload();
    }
  });
};
</script>
{% endblock %}
